<div in:fade class="p-10">
  <div class="flex justify-around items-center color-white">
    <i class="w-15 h-15 op-70">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><g fill="none"><path d="M12 5.21v5.058A2 2 0 1 0 13 12V1.926a.8.8 0 0 0-1.07-.754l-6.4 2.286a.8.8 0 0 0-.53.753v7.056A2 2 0 1 0 6 13V7.353l6-2.142z" fill="currentColor" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill=""></path></g></svg>
    </i>
    <i class="h-30 w-30">
      <svg class="svg-icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path d="M225.904 424.896C177.876 424.896 138.8 463.972 138.8 512s39.076 87.102 87.104 87.102 87.102-39.074 87.102-87.102-39.074-87.104-87.102-87.104z m0 159.762c-40.066 0-72.66-32.594-72.66-72.658 0-40.066 32.594-72.66 72.66-72.66 40.064 0 72.658 32.594 72.658 72.66 0 40.064-32.594 72.658-72.658 72.658z" fill="#4A555F" />
        <path class="spikeFirst" d="M225.904 456.194c-30.772 0-55.808 25.034-55.808 55.806s25.036 55.808 55.808 55.808 55.806-25.036 55.806-55.808-25.034-55.806-55.806-55.806z" fill="#DFDFDF" />
        <path d="M784.79 295.28c-48.028 0-87.104 39.074-87.104 87.102s39.076 87.102 87.104 87.102 87.102-39.074 87.102-87.102-39.074-87.102-87.102-87.102z m0 159.76c-40.066 0-72.66-32.594-72.66-72.658s32.594-72.658 72.66-72.658c40.064 0 72.658 32.594 72.658 72.658s-32.596 72.658-72.658 72.658z" fill="#4A555F" />
        <path class="spikeFirst" d="M784.788 326.576c-30.772 0-55.808 25.036-55.808 55.808s25.036 55.806 55.808 55.806 55.806-25.034 55.806-55.806-25.034-55.808-55.806-55.808z" fill="#DFDFDF" />
        <path d="M784.79 554.516c-48.028 0-87.104 39.074-87.104 87.102 0 48.028 39.076 87.104 87.104 87.104s87.102-39.076 87.102-87.104c-0.002-48.028-39.074-87.102-87.102-87.102z m0 159.762c-40.066 0-72.66-32.594-72.66-72.66 0-40.064 32.594-72.658 72.66-72.658 40.064 0 72.658 32.594 72.658 72.658-0.002 40.066-32.596 72.66-72.658 72.66z" fill="#4A555F" />
        <path class="spikeSecond" d="M784.788 585.812c-30.772 0-55.808 25.036-55.808 55.808s25.036 55.806 55.808 55.806 55.806-25.034 55.806-55.806-25.034-55.808-55.806-55.808z" fill="#DFDFDF" />
        <path d="M510.266 36.04c-48.028 0-87.102 39.076-87.102 87.104s39.074 87.102 87.102 87.102c48.028 0 87.104-39.074 87.104-87.102 0-48.028-39.076-87.104-87.104-87.104z m0 159.762c-40.064 0-72.658-32.594-72.658-72.658 0-40.066 32.594-72.66 72.658-72.66 40.066 0 72.66 32.594 72.66 72.66 0 40.064-32.594 72.658-72.66 72.658z" fill="#4A555F" />
        <path class="spikeSecond" d="M510.266 67.338c-30.772 0-55.806 25.034-55.806 55.806s25.034 55.808 55.806 55.808 55.808-25.036 55.808-55.808-25.036-55.806-55.808-55.806z" fill="#F58E6F" />
        <path d="M510.266 295.28c-48.028 0-87.102 39.074-87.102 87.102s39.074 87.102 87.102 87.102c48.028 0 87.104-39.074 87.104-87.102s-39.076-87.102-87.104-87.102z m0 159.76c-40.064 0-72.658-32.594-72.658-72.658s32.594-72.658 72.658-72.658c40.066 0 72.66 32.594 72.66 72.658s-32.594 72.658-72.66 72.658z" fill="#4A555F" />
        <path class="spikeFirst" d="M510.266 326.576c-30.772 0-55.806 25.036-55.806 55.808s25.034 55.806 55.806 55.806 55.808-25.034 55.808-55.806-25.036-55.808-55.808-55.808z" fill="#F58E6F" />
        <path d="M510.266 554.516c-48.028 0-87.102 39.074-87.102 87.102 0 48.028 39.074 87.104 87.102 87.104 48.028 0 87.104-39.076 87.104-87.104s-39.076-87.102-87.104-87.102z m0 159.762c-40.064 0-72.658-32.594-72.658-72.66 0-40.064 32.594-72.658 72.658-72.658 40.066 0 72.66 32.594 72.66 72.658 0 40.066-32.594 72.66-72.66 72.66z" fill="#4A555F" />
        <path class="spikeSecond" d="M510.266 585.812c-30.772 0-55.806 25.036-55.806 55.808s25.034 55.806 55.806 55.806 55.808-25.034 55.808-55.806-25.036-55.808-55.808-55.808z" fill="#F58E6F" />
        <path d="M510.266 813.754c-48.028 0-87.102 39.076-87.102 87.104s39.074 87.102 87.102 87.102c48.028 0 87.104-39.074 87.104-87.102s-39.076-87.104-87.104-87.104z m0 159.76c-40.064 0-72.658-32.594-72.658-72.658 0-40.066 32.594-72.66 72.658-72.66 40.066 0 72.66 32.594 72.66 72.66 0 40.064-32.594 72.658-72.66 72.658z" fill="#4A555F" />
        <path class="spikeFirst" d="M510.266 845.05c-30.772 0-55.806 25.034-55.806 55.806s25.034 55.808 55.806 55.808 55.808-25.036 55.808-55.808-25.036-55.806-55.808-55.806z" fill="#F58E6F" />
        <path d="M291.906 466.5l134.98-74.902 7.01 12.628-134.982 74.9zM291.918 558.406l7.006-12.628 134.996 74.884-7.006 12.63zM0 504.78h108.988v14.444H0z" fill="#4A555F" />
        <path d="M75.014 463.83l-10.698 9.71 34.834 38.372-34.742 36.886 10.514 9.904 43.902-46.612zM905.176 375.942h108.988v14.444h-108.988z" fill="#4A555F" />
        <path d="M980.19 334.994l-10.698 9.708 34.836 38.374-34.744 36.886 10.514 9.902L1024 383.254zM905.176 635.18h108.988v14.444h-108.988z" fill="#4A555F" />
        <path d="M980.19 594.232l-10.698 9.71 34.836 38.37-34.744 36.89 10.514 9.902L1024 642.49zM567.638 586.778l154.396-154.396 10.212 10.212-154.396 154.396z" fill="#4A555F" />
        <path d="M565.16 440.104l10.214-10.212 154.212 154.212-10.212 10.212zM241.506 430.546L444.888 171.768l11.354 8.924-203.38 258.78zM241.498 592.378l11.354-8.924 203.38 258.778-11.354 8.924zM567.654 177.994l10.21-10.22 154.378 154.248-10.21 10.218zM567.634 846.534l154.4-154.226 10.208 10.22-154.4 154.224z" fill="#4A555F" />
      </svg>
    </i>
    <i class="w-15 h-15 op-70">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 640 512"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" fill="currentColor" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill=""></path></svg>
    </i>
  </div>
  <div class="flex items-center m-t-10">
    <span class="color-white op-70 font-mono">{$percentage.toFixed(2)} %</span>
    <div class="flex-1 bg-zinc-800 m-x-5 rounded">
      <div class="bg-green h-3 rounded" style="width: {$percentage}%"></div>
    </div>
    <i class="color-white op-70 hover:color-red hover:op-100 active:op-70 transition-all w-5 h-5" on:click={cancel}>
      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17L12 13.41L8.41 17L7 15.59L10.59 12L7 8.41L8.41 7L12 10.59L15.59 7L17 8.41L13.41 12L17 15.59z" fill="currentColor" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill=""></path></svg>
    </i>
  </div>
</div>

<style>
  @keyframes spike {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  .spikeFirst {
    opacity: 0;
    animation: 1s ease-in-out 0s infinite alternate spike;
  }
  .spikeSecond {
    opacity: 0;
    animation: 1s ease-in-out 1s infinite alternate spike;
  }
</style>

<script>
import {fade} from 'svelte/transition'
import { onMount } from "svelte";
import {tweened} from 'svelte/motion'
import {quadInOut} from 'svelte/easing'

// if (!localStorage.getItem('taskId')) {
//   location.hash = '/'
// }

const taskId = localStorage.getItem('taskId') ?? 'ID114514'

function cancel() {
  window.location.href = '/';
}

const percentage = tweened(0, {
  duration: 500,
  easing: quadInOut
})

function updatePercentage(){
  if ($percentage >= 100) {
    // Finish!
    localStorage.removeItem('taskId')
    setTimeout(() => {
      location.hash = '/success?taskId=' + taskId
    }, 1000);
  } else {
    percentage.set($percentage + 5)
  }
  setTimeout(updatePercentage, 1000)
}

onMount(() => {
  // TODO: Frequently update the percentage
  updatePercentage()
})


</script>